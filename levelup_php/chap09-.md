# 第9章〜

## 第9章

### アーキテクチャ

- MVC

> Model モデルはデータ層です。アプリケーションが扱うデータを取り扱います。Webアプリケーションでは、データベースやファイル、セッション、クッキーなどが該当します。
> View Viewは出力層です。HTMLや画像などを駆使して、Modelが生成したデータを最終的にユーザーに表示します。フロントエンドJS風に言うと、レンダリングに相当します。また、ユーザーからの入力を受け付けて、コントローラーへと渡す役割もあります。
> Controller コントローラーは、キャプテンや監督、司令塔の役割を果たします。ビューから受け取った入力パラメータをモデルに渡したり、ビューが表示しやすいように、モデルから受け取った値を加工することもあります。ビューやモデルを活用して、全体を制御するのがコントローラーの役割です。

- MVCの限界
  - アプリケーションの大規模化により、MVCでは管理しにくくなってきた（モデルの肥大化）
    - MVCの3層にさらにレイヤーを追加するアプローチ（レイヤー追加系アーキテクチャーとまとめてある）
    - Laravelの例
      - [バーガーショップで例えるオールアバウトでのLaravelアーキテクチャー](https://allabouttech.hatenablog.com/entry/2016/11/29/100000)
  - マイクロサービスアーキテクチャ
    - 小さなサービスを複数つなげて大きなサービスにするアプローチ
    - サービス館での連携が大切になるが、個々のサービスは管理しやすいアーキテクチャになる
    - それぞれのサービスのサーバーの管理が大変になるという欠点がある

## 10章

### コーディング規約

- PSR
  - [PSRの一覧](https://www.phpfig.org/psr/)
  - PHPのお作法が書かれているので出来るだけ守ったほうが良い

## 11章

### 正規表現

- 正規表現にも種類がある
  - １．PCRE（PerlCompatibleRegularExpressions）正規表現を扱うpreg関数群
  - ２．POSIX拡張正規表現を扱うereg関数群（PHP5.3で非推奨、PHP7で削除）ereg関数郡は、PHP7で使うことができない
- 拡張正規表現は使わないほうが良い
- 正規表現のデリミタは `/` 以外も使える（例として、`/ # ~ @` など）
- 文字列の終端の判定の際は、複数行モードと改行の扱いに気を付ける
- `*` は最短マッチ、 `+` は最長マッチ
- pregは遅い
- 日本語（UTF-8）を使った正規表現は `u修飾子` をつけて使うこと

## 12章

### テンプレートエンジン

- Smarty
  - composerからインストールできる
  - HTMLインジェクションの回避のため自動エスケープ
  - assign経由でテンプレートで表示したい値だけを受け渡す
  - テンプレートファイルが分離されていることで、HTMLロジックとPHPのロジック（コントローラー）が切り離されている
  - 共通化したパーツをテンプレートに切り出せる
- 上記を見ていると、bladeテンプレートと同じような感じ
- EC-CUBEでSmartyが使われている
- `<% ~ %>`と`<%=`がphp7.0で使えなくなった（ASPタグ）
- `<script language="php">`がPHP7.0で使えなくなった（スクリプトタグ）
- `<?=` は常に使えるようになった
  - `<?= $val ?>`は、`<?php echo $val ?>`と同義

## 13章

### パフォーマンスとデバッグ

- PHPのパフォーマンスが問題になることはほとんどない
  - 大体はDBがボトルネック
- webサイトの判断基準
  - ~500msec : 早い
  - ~1sec : 少し早い
  - ~3sec : 普通
  - 3sec~ : 遅い
- 値渡しと参照渡し
  - 値渡し：値そのものを渡す
  - 参照渡し：変数のポインタを渡す
- メルカリのフレームワークDietCake